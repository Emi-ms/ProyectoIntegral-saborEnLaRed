<div class="white-box"></div>

<div class="form-div">
    <div class="form-group row">
        <form class="form" [formGroup]="recipeForm" (ngSubmit)="createRecipe()" enctype="multipart/form-data">
            <div class="form-group row">
                <div class="col-md-6 ">
                    <label for="recipeName">Nombre de la Receta:</label>
                    <input formControlName="recipeName" id="recipeName" type="text" placeholder="Nombre de la receta"
                        class="form-control">
                    <div *ngIf="f['recipeName'].touched && f['recipeName'].invalid" class="alert alert-danger">
                        <div *ngIf="f['recipeName'].errors?.['required']">*Nombre es requerido.</div>
                        <div *ngIf="f['recipeName'].errors?.['pattern']">*El nombre sólo puede contener letras.</div>
                        <div *ngIf="f['recipeName'].errors?.['maxlength']">*El nombre debe tener menos de 255 caracteres
                        </div>
                    </div>
                </div>
                <div class="col-md-6 ">
                    <label for="description">Descripción:</label>
                    <textarea formControlName="description" id="description" class="form-control"
                        placeholder="Descripción de la receta"></textarea>
                    <div *ngIf="f['description'].touched && f['description'].invalid" class="alert alert-danger">
                        <div *ngIf="f['description'].errors?.['required']">*La descripción de la receta es requerida.
                        </div>
                        <div *ngIf="f['description'].errors?.['maxlength']">*La descripción debe tener menos de 1000
                            caracteres
                        </div>
                    </div>
                </div>
                <div class="col-md-6 ">
                    <label for="photo">Foto:</label>
                    <input id="photo" type="file" placeholder="Nombre del archivo de la foto" class="form-control"
                        (change)="onFileChange($event)">
                </div>
                <div class="select-wrapper">
                    <mat-form-field class="example-full-width">
                        <mat-label>Ingrediente</mat-label>
                        <input type="text" matInput [formControl]="ingredientControl" [matAutocomplete]="auto">
                        <mat-autocomplete [displayWith]="displayFn" autoActiveFirstOption #auto="matAutocomplete">
                            <mat-option *ngFor="let ingredient of filteredIngredients | async" [value]="ingredient">
                                {{ ingredient.ingredientName }}
                            </mat-option>
                        </mat-autocomplete>
                    </mat-form-field>

                    <mat-form-field appearance="fill">
                        <mat-label>Cantidad</mat-label>
                        <input matInput formControlName="quantity" #quantity placeholder="Cantidad" required>
                        <mat-error *ngIf="f['quantity'].touched && f['quantity'].invalid">
                            <div *ngIf="f['quantity'].errors?.['required']">*La cantidad es requerida.</div>
                            <div *ngIf="f['quantity'].errors?.['pattern']">*La cantidad debe ser un número válido.</div>
                        </mat-error>
                    </mat-form-field>

                    <!-- 

                    <input formControlName="quantity" #quantity type="text" placeholder="Cantidad" required>
                    <div *ngIf="f['quantity'].touched && f['quantity'].invalid" class="alert alert-danger">
                        <div *ngIf="f['quantity'].errors?.['required']">*La cantidad es requerida.</div>
                        <div *ngIf="f['quantity'].errors?.['pattern']">*La cantidad debe ser un número válido.</div>
                    </div> -->

                    <!-- <input formControlName="unitMeasure" #unitMeasure type="text" placeholder="Unidad de medida">
                    <div *ngIf="f['unitMeasure'].touched && f['unitMeasure'].invalid" class="alert alert-danger">
                        <div *ngIf="f['unitMeasure'].errors?.['required']">*La cantidad es requerida.</div>
                        <div *ngIf="f['unitMeasure'].errors?.['pattern']">*La unidad de medida sólo puede contener
                            letras</div>
                        <div *ngIf="f['unitMeasure'].errors?.['maxlength']">*La unidad de medida debe tener menos de 255
                            caracteres
                        </div> -->
                    <!-- </div> -->
                    <mat-form-field appearance="fill">
                        <mat-label>Unidad de medida</mat-label>
                        <input matInput formControlName="unitMeasure" #unitMeasure placeholder="Unidad de medida">
                        <mat-error *ngIf="f['unitMeasure'].touched && f['unitMeasure'].invalid">
                            <div *ngIf="f['unitMeasure'].errors?.['required']">*La cantidad es requerida.</div>
                            <div *ngIf="f['unitMeasure'].errors?.['pattern']">*La unidad de medida sólo puede contener
                                letras</div>
                            <div *ngIf="f['unitMeasure'].errors?.['maxlength']">*La unidad de medida debe tener menos de
                                255 caracteres</div>
                        </mat-error>
                    </mat-form-field>
                    <button type="button"
                        (click)="addIngredient(ingredientControl.value, quantity.value, unitMeasure.value)">Agregar
                        ingrediente</button>
                </div>
                <div class="select-wrapper">
                    <mat-form-field>
                        <mat-label>Categorías</mat-label>
                        <mat-select [formControl]="selectedCategoryControl">
                            @for (category of categoriesFromAPI; track categoriesFromAPI) {
                            <mat-option [value]="category">{{category.categoryName}}</mat-option>
                            }
                        </mat-select>
                    </mat-form-field>

                    <button type="button" (click)="addCategory(selectedCategoryControl.value!)">Agregar
                        categoría</button>
                </div>
                <div formArrayName="recipeIngredients">
                    <div *ngFor="let ingredientCtrl of recipeIngredientsFromForm.controls; index as i"
                        [formGroupName]="i">
                        <span>Ingrediente: {{ ingredientCtrl.value.ingredient.ingredientName }} </span>
                        <span> Cantidad: {{ ingredientCtrl.value.quantity }} </span>
                        <span> Unidad de medida: {{ ingredientCtrl.value.unitMeasure }}</span>
                        <button type="button" (click)="removeIngredient(i)"><i class="fa fa-trash"></i></button>
                    </div>
                </div>
                <div formArrayName="categories">
                    <div *ngFor="let categoryCtrl of categoriesFromForm.controls; index as i" [formGroupName]="i">
                        <p>Categoría: {{ categoryCtrl.value.categoryName }}</p>
                    </div>
                </div>
            </div>
            <button type="submit">Crear Receta</button>
        </form>
    </div>
</div>